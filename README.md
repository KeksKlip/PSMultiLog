[![Build status](https://ci.appveyor.com/api/projects/status/eenv9fp141byaube?svg=true)](https://ci.appveyor.com/project/AdamPlatt/psmultilog)

# PSMultiLog
PSMultiLog is a multi-target logging module to simplify and centralize logging in your code. At the beginning of your code, turn on the log targets you want to use, and from the on just call the `Write-Log` Cmdlet to simultaneously write to all active targets.

## Log targets
The PSMultiLog module supports the following log targets:

- File
- Host (great for debugging, or when you're first building a script)
- PassThru (will write to the verbose, warning, and error streams)
- Event Log
- Email (log events are collected, and then the `Send-EmailLog` Cmdlet is used to send the actual e-mail)
- Slack webhook integration

## Compatibility
As of version 2.0.0, The PSMultiLog module is compatible with PowerShell __v3.0__ and up. for compatability with __v2.0__, please use version 1.1.1 (commit 94e4207).

## Installation
Copy the module into a folder in your PowerShell Module Path. You can check `$env:PSModulePath` in a PowerShell session if unsure what paths are included, but starting in PowerShell v4.0 the standard is `C:\Program Files\WindowsPowerShell\Modules`. Don't put the code directly into the Modules folder, it must be in a subfolder named `PSMultiLog`.

## Usage
Here is a simple example of using multiple log targets. Note that when you enable a log target, you also specify what severity log entries to write to it. In the example below, we are everything to a log file, but only errors to the event log.

```powershell
# Import the module.
Import-Module PSMultiLog

# Turn on desired targets.
Start-FileLog -FilePath c:\ps\info.log -LogLevel Information # Log everything.
Start-EventLogLog -Source "SampleScript" # The default value for LogLevel is "Error".

# Write log entries.
Write-Log -EntryType Information -Message "This will only get logged to file."
Write-Log -EntryType Warning -Message "This will only get logged to file."
Write-Log -EntryType Error -Message "This will get logged both to file and to the Event Log."

# Turn off targets (this is sort of optional, since it won't matter once the script exits).
Stop-FileLog
Stop-EventLogLog
```

## Sample Output

Below is some sample output generated by the following code:

```powershell
Start-HostLog -LogLevel Information
Start-FileLog -LogLevel Information -FilePath c:\ps\Log.txt
Start-EventLogLog -Source "PowerShell Sample" -LogLevel Information
Start-EmailLog

Write-Log -EntryType Information -Message "This is a sample log message."
Write-Log -EntryType Warning -Message "This is a sample warning."
Write-Log -EntryType Error -Message "This is a sample error."
Write-Log -EntryType Error -Message "This is a sample error with an exception." -Exception (New-Object -TypeName Exception)

Send-EmailLog -SmtpServer smtp.host.com -To platta@gmail.com -From platta@gmail.com -Subject "Sample Log" -Message "This is a sample log." -LogLevel Information

Stop-EmailLog
Stop-EventLogLog
Stop-FileLog
Stop-HostLog
```

### Host Log

The following will be output to the host:

![Host Log](https://cloud.githubusercontent.com/assets/946913/10434414/554666e6-70e7-11e5-99f4-601ab9218a02.PNG)

### File Log

The contents of `c:\ps\Log.txt` will be:

```
[2015-10-12 13:32:10Z] - INFO - This is a sample log message.
[2015-10-12 13:32:10Z] - WARN - This is a sample warning.
[2015-10-12 13:32:10Z] - ERRR - This is a sample error.
[2015-10-12 13:32:10Z] - ERRR - This is a sample error with an exception. - Exception: Exception of type 'System.Exception' was thrown.
```

### Event Log Log

The following Events will be created:

![Event Log - Information](https://cloud.githubusercontent.com/assets/946913/10434412/55451840-70e7-11e5-863e-de06a39ae24d.PNG)

![Event Log - Warning](https://cloud.githubusercontent.com/assets/946913/10434413/55458ba4-70e7-11e5-9612-59a5e9c573c6.PNG)

![Event Log - Error](https://cloud.githubusercontent.com/assets/946913/10434411/55444140-70e7-11e5-8dc8-a104ec2f09a4.PNG)

![Event Log - Error with Exception](https://cloud.githubusercontent.com/assets/946913/10434410/5542f72c-70e7-11e5-8473-79cc6048d7f4.PNG)

The Source, Stack Trace, and Target Site properties would be populated on a real exception.

### E-mail Log

An e-mail will be generated which looks like this:

![E-mail Log](https://cloud.githubusercontent.com/assets/946913/10434409/5542458e-70e7-11e5-97a7-bdf6d114d179.PNG)

The Source, Stack Trace, and Target Site properties would be populated on a real exception.

## About Slack Integration

Integrating with Slack requires setting up an [Incoming Webhook](https://api.slack.com/incoming-webhooks), but don't worry about knowing the details of how to make the HTTP calls. All you really need is the URL they will provide once you enable the integration. For additional information about how to use Slack logging, see `Get-Help Start-SlackLog`.
